<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<title>东风标致圣诞奇遇记</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" type="text/css" href="css/style.css"/>
	<link rel="stylesheet" type="text/css" href="css/my.css"/>
	</head>

<body>
<div class="horizontal">
    <h1>请您保持横屏浏览并重新读取网站</h1>
</div>
<script>
    if(window.innerWidth>window.innerHeight){
        document.getElementsByClassName('horizontal').item(0).style.display = 'block';
    }
</script>



<div id="loading">
    <img src="img/loading/loadbg.jpg" class="load_bar" style="width: 100%;height: 100%;" >
    <img src="img/loading/loading.png" class="load_bar" >
    <img src="img/load.gif" style="width: 100%;height: 100%;position: absolute;left: 0;top: 0;" />	
   	<div id="load_bar" class="ani" >
        <img src="img/loading/loadingb.png" class="load_bar" >
    </div>
</div>


<div id="yxjs">
    <img src="img/top_lan.png" class="top_lan" />
    <img src="img/musk.png" class="music_k music" />
    <img src="img/musg.png" class="music_g music" />
    <div class="musicgai"></div>
	<img src="img/pao1.png"  class="pao pao1"/>
	<img src="img/pao2.png"  class="pao pao2"/>
	<img src="img/zsh1.png" class="zsh zsh1" />
		<img src="img/zsh2.png" class="zsh zsh2" />
			<img src="img/zsh3.png" class="zsh zsh3" />
	<img src="img/yysj.png" class="yysj" />	
	<img src="img/fxqp.png" class="fxqp" />	
	<img src="img/fx.png" class="fx"  style="position: absolute;left: 0;top: 0;width: 100%;height: 100%;display: none;" />		
</div>

<div id="yysj" style="display: none;">
    <img src="img/top_lan.png" class="top_lan" />
    <img src="img/musk.png" class="music_k music" />
    <img src="img/musg.png" class="music_g music" />
    <div class="musicgai"></div>
	<div class="yyl">
		<input type="text" class="name" placeholder="请输入您的姓名" />
		<input type="text" class="tel" placeholder="请输入您的电话" />
		<select class="s">
			<option selected="selected">省</option>
		</select>
		<select class="si">
			<option selected="selected">市</option>
		</select>
		<div class="yytj">
			
		</div>
	</div>
</div>

<div id="Allstuff" >

    <img src="img/top_lan.png" class="top_lan" />
    <img src="img/musk.png" class="music_k music" />
    <img src="img/musg.png" class="music_g music" />
    <div class="musicgai"></div>
    

	<!--<div style="position: absolute;left: 0;top: 0;color: #fff;z-index: 99999999999999999999999;">map.x:<span class="mapx"></span></div>
	<div style="position: absolute;left: 0;top: 50px;color: #fff;z-index: 99999999999999999999999;">map.y:<span class="mapy"></span></div>
	-->

	<div id="Prompt">
		<img src="img/Prompt1.png" class="com_bg">
	</div>
	
	<div id="details" class="popw">
		<img src="img/details.png" class="com_bg">
		<img src="img/close.png" class="com_btn" id="det_close">
		<div class="details_text">
			<div>
				<img src="img/details-c.png" class="details-c">
			</div>
		</div>
	</div>
	
	<div class="gameArea">
		<div class="trf" id="mapc">
			<div id="map" class="trf">
				<img src="img/map.jpg" class="map">
				<img src="img/5s.png" class="mapPoint flash" id="point1">
				<img src="img/4s.png" class="mapPoint flash" id="point2">
				<img src="img/3s.png" class="mapPoint flash" id="point3">
				<img src="img/2s.png" class="mapPoint flash" id="point4">
				<img src="img/1s.png" class="mapPoint flash" id="point5">
				<img src="img/6s.png" class="mapPoint flash" id="point6">
			</div>
		</div>
		<img src="img/car.png" id="car" class="ani">
	</div>
	
	<div id="pop" class="popw">
		<img src="img/l1_l.png" class="lu l1_l"  />
		<img src="img/l1_h.png" class="lu l1_h"  />
		<img src="img/l2_l.png" class="lu l2_l"  />
		<img src="img/l2_h.png" class="lu l2_h"  />
		<img src="img/l4_l.png" class="lu l4_l"  />
		<img src="img/l4_h.png" class="lu l4_h"  />
		<img src="img/l3_l.png" class="lu l3_l"  />
		<img src="img/l3_h.png" class="lu l3_h"  />
		<div id="p1" class="pop ps">
			<img src="img/qjcl.png" class="com_btn close" data-rol="p1">
			<img src="img/price/p1g.png" class="com_bg com_bgp1">
		</div>
		<div id="p2" class="pop ps">
			<img src="img/qjcl.png" class="com_btn close" data-rol="p2">
			<img src="img/price/p2g.png" class="com_bgp1">
		</div>
		<div id="p3" class="pop ps">
			<img src="img/qjcl.png" class="com_btn close" data-rol="p3">
			<img src="img/price/p3g.png" class="com_bgp1">
		</div>
		<div id="p4" class="pop ps">
			<img src="img/qjcl.png" class="com_btn close" data-rol="p4">
			<img src="img/price/p4g.png" class="com_bgp1">
		</div>
	</div>
	
	<div id="hint">
		<img src="img/price/price.png" class="com_bg pricej">
		<img src="img/price/p1.png" class="com_bg pri" id="pri_pic1">
		<img src="img/price/p2.png" class="com_bg pri" id="pri_pic2">
		<img src="img/price/p3.png" class="com_bg pri" id="pri_pic3">
		<img src="img/price/p4.png" class="com_bg pri" id="pri_pic4">
		<div class="hint_btns">
			<img src="img/price/pbtn.png" id="hit_more">
			<!--<img src="img/price/pbtnr.png" id="hit">-->
		</div>
	</div>
					
						
					
	    
	    
    <div class="snow-container"></div>

    <img src="img/gj.png" class="gj" />
    
    
</div>


<div id="wrap" class="wrapper" style="display: none;">
	
	 <audio src="img/hm.mp3" id="hm" loop="loop" style="position: absolute;left: 0;top: 0;opacity: 0;z-index: -1;" autoplay="autoplay">
	您的浏览器不支持 audio 标签。
	</audio>
	
	<img src="img/top_lan.png" class="top_lan" />
    <img src="img/musk.png" class="music_k music" />
    <img src="img/musg.png" class="music_g music" />
    <div class="musicgai"></div>
	
	<div id="pages">
		<div class="page page1">
			<img src="img/rou1.png" class="rou rou1" />
			<img src="img/rou2.png" class="rou rou2" />
			<img src="img/rou3.png" class="rou rou3" />
			<img src="img/text1.png" class="text text1" />
			<img src="img/iconup.png" class="iconup" />
		</div>
		<div class="page page2">
			<img src="img/hair1.png" class="hair hair1" />
			<img src="img/hair2.png" class="hair hair2" />
			<img src="img/hair3.png" class="hair hair3" />
			<img src="img/text2.png" class="text text2" />
			<img src="img/iconup.png" class="iconup" />
		</div>
		<div class="page page3">
			<img src="img/hz1.png" class="hz hz1" />
			<img src="img/hz2.png" class="hz hz2" />
			<img src="img/hz3.png" class="hz hz3" />
			<img src="img/text3.png" class="text text3" />
			<img src="img/iconup.png" class="iconup" />
		</div>
		<div class="page page4">
			<img src="img/xz1.png" class="xz xz1" />
			<img src="img/xz2.png" class="xz xz2" />
			<img src="img/xz3.png" class="xz xz3" />
			<img src="img/text4.png" class="text text4" />
			<img src="img/iconup.png" class="iconup" />
		</div>
		<div class="page page5">
			<img src="img/text5.png" class="text text5" />
			<img src="img/ksyx.png" class="ksyx" />
		</div>
	</div>
</div>



<script src="js/jquery-1.11.1.min.js"></script>
<script src="js/three.js"></script>
<script src="js/index.js"></script>
<script>
/*
if (location.hash == '#shareflag') {
    location.href='index.html';
}
location.href += '#shareflag';
*/
var f = 480/854;

var win = {
    w : $(window).width(),
    h : $(window).height()
}
$('#load_bar').css('height',win.w/f);
$('.load_bar').css('width',win.w);

var musicBtn = {
    state : true,
    musicPlay : function() {
        $('#music').addClass('music');
        var music = document.getElementById('bgmusic');  
        music.play();           // 播放，或者重新播放
    },
    musicStop : function() {
        $('#music').removeClass('music');
        var music = document.getElementById('bgmusic');  
        music.pause();           // 暂停播放
    },
    action : function () {
        if( musicBtn.state ) {
            musicBtn.musicStop();
            musicBtn.state = false;
        } else {
            musicBtn.musicPlay();
            musicBtn.state = true;
        }
    }
}

var hm=document.getElementById('hm');
var musflag=false;
$('.musicgai').bind('touchstart',function(){
    if(musflag==false){
    	$('.music_g').show();
    	$('.music_k').hide();
    	hm.pause();
    	musflag=true;
    }else if(musflag==true){
    	$('.music_g').hide();
    	$('.music_k').show();
    	hm.play();
    	musflag=false;
    }
});

//$(document).on('touchstart',function(e){
//  e.preventDefault();
//})

//$('#Prompt_text').on('touchstart',function(){
//  $('#details').show('fast');
//});
//
//$('#details').on('touchstart',function(){
//  event.stopPropagation();
//})



setInterval(function(){
	
	setTimeout(function(){
		$('.rou').hide();
		$('.rou1').show();
	},1000);
	setTimeout(function(){
		$('.rou').hide();
		$('.rou2').show();
	},2000);
	setTimeout(function(){
		$('.rou').hide();
		$('.rou3').show();
	},3000);
	
},1500);

setInterval(function(){
	
	setTimeout(function(){
		$('.hair').hide();
		$('.hair1').show();
	},400);
	setTimeout(function(){
		$('.hair').hide();
		$('.hair2').show();
	},800);
	setTimeout(function(){
		$('.hair').hide();
		$('.hair3').show();
	},1200);
	
},800);


setInterval(function(){
	
	setTimeout(function(){
		$('.hz').hide();
		$('.hz1').show();
	},400);
	setTimeout(function(){
		$('.hz').hide();
		$('.hz2').show();
	},800);
	setTimeout(function(){
		$('.hz').hide();
		$('.hz3').show();
	},1200);
	
},800);


setInterval(function(){
	
	setTimeout(function(){
		$('.xz').hide();
		$('.xz1').show();
	},200);
	setTimeout(function(){
		$('.xz').hide();
		$('.xz2').show();
	},400);
	setTimeout(function(){
		$('.xz').hide();
		$('.xz3').show();
	},1000);
	
},400);


setInterval(function(){
	
	setTimeout(function(){
		$('.zsh').hide();
		$('.zsh1').show();
	},200);
	setTimeout(function(){
		$('.zsh').hide();
		$('.zsh2').show();
	},300);
	setTimeout(function(){
		$('.zsh').hide();
		$('.zsh3').show();
	},400);
	
},500);


$('input,select').bind('touchstart',function(){
   $(this).focus();
});


bulid();
function bulid(){
    var f = 480 / 854;
    $('#hint').css({'width':win.h * f,'height':win.h,'left':(win.w-win.h*f)/2});
    $('.popw').css({'width':win.h * f,'height':win.h,'left':(win.w-win.h*f)/2});
    $('#car').css({'top':-(1200-win.h)/2,'left':-(1200-win.w)/2});
	$('.com_wrap').css('width',win.w);
}

var l = -(3000-win.w)/2;
var r = -(4384-win.h)/2;
var IPDEG = 2*3.14/360;
var SPEED = 5;
var myStart=false;

$('#map').css({'left':l,'top':r})

var mapArea = {
     x : [ -1100, 1100 ], 
     y : [ -1500, 1500 ]
}

var priceArea = {
    outArea : true,
    p1 : [ 150, -150, -400, -685 ],
    p2 : [ -59, -408, 220, -47 ],
    p3 : [ 796, 447, 447, 336 ],  
    p4 : [ -421, -711, 1000, 683 ],
    p5 : [ 439, 182, 1500, 1123 ],
    p6 : [ 839, 500, 1000, 1123 ]
}

var priceVal = {
    piece : 0,
    pieceNum : [false,false,false,false,false],
    stopCar : true,
    date : ''
}

var map = {
    r : 0,
    x : 0,
    y : 0,
    g : 0
}

var START = {
    shake : 0,
    loadin : false
}

$(window).on('deviceorientation',function(){  //deviceorientation 设备定位事件；
    var b = event.beta;  
    var g = event.gamma;
    var a = event.alpha;
    var ch = event.CompassHeading;
    var ca = event.CompassAccuracy;
    
    
    $('.alpha').text(a);
    $('.beta').text(b);
    $('.gamma').text(g);
    $('.ch').text(ch);
    $('.ca').text(ca);
    /**
     * alpha: 在围绕 z 轴旋转时（即左右旋转时），y 轴的度数差。
	   beta: 在围绕 x 轴旋转时（即前后旋转时），z 轴的度数差。  
	   gamma: 在围绕 y 轴旋转时（即扭转设备时），z 轴的度数差。 
	*/
    
   if( g < -30 && START && START.loadin){
        START.shake += 1;
        if( START.shake >  8){
            START = false;
//          $('#Prompt').fadeOut('fast');
//          setTimeout(function(){priceVal.stopCar = false},1200);
        }
        return;
    }
    
    if(!priceVal.stopCar){
        map.r += -parseInt(g)/10;
        
        if(map.r>360){
            map.r -= 360;
        } else if(map.r<-360){
            map.r += 360;
        }
    
        if( b <= 50 ){
            map.y += Math.cos(map.r*IPDEG) * SPEED;
            map.x += Math.sin(map.r*IPDEG) * SPEED;
        }
        
        //判断边界
        if( map.x >= mapArea.x[1] ){
            map.x = mapArea.x[1]
        } else if ( map.x <= mapArea.x[0] ) {
            map.x = mapArea.x[0];
        }
        if ( map.y >= mapArea.y[1] ) {
            map.y = mapArea.y[1]
        } else if ( map.y <= mapArea.y[0] ) {
            map.y = mapArea.y[0]
        }
        
        mapMove(map.x,map.y,map.r); carMov(g); 
    }
    
    if(map.x < priceArea.p1[0] && map.x > priceArea.p1[1] && map.y < priceArea.p1[2] && map.y > priceArea.p1[3] && !priceVal.pieceNum[0]){
        //if(!priceVal.pieceNum[0]){
            priceVal.pieceNum[0] = true;
            priceVal.piece += 1;
            carLight('5');
            SPEED = 2;
        //}
        //if(priceArea.outArea){
            showPop('p1');
            $('.l1_h').hide();
            showHint(1);
//          alert('找到了p1提示窗！');
            $('#point5').hide();
        //priceArea.outArea = false;        
    } else if (map.x < priceArea.p2[0] && map.x > priceArea.p2[1] && map.y < priceArea.p2[2] && map.y > priceArea.p2[3] && !priceVal.pieceNum[1]) {
        //if(!priceVal.pieceNum[1]){
            priceVal.pieceNum[1] = true;
            priceVal.piece += 1;
            carLight('4');
            SPEED = 2;
        //}
        //if(priceArea.outArea){}
        showPop('p4');
//      alert('找到了p2提示窗！');
        $('.l2_h').hide();
        showHint(4);
        $('#point4').hide();
        
        //priceArea.outArea = false;
    } else if (map.x < priceArea.p3[0] && map.x > priceArea.p3[1] && map.y < priceArea.p3[2] && map.y > priceArea.p3[3] && !priceVal.pieceNum[2]) {
        //if(!priceVal.pieceNum[2]){
            priceVal.pieceNum[2] = true;
            priceVal.piece += 1;
            carLight('3');
            SPEED = 2;
        //}
        //if(priceArea.outArea){}
        showPop('p2');
//      alert('找到了p3提示窗！');
        $('.l3_h').hide();
            showHint(2);
            $('#point3').hide();
        //priceArea.outArea = false;
    } else if (map.x < priceArea.p4[0] && map.x > priceArea.p4[1] && map.y < priceArea.p4[2] && map.y > priceArea.p4[3] && !priceVal.pieceNum[3]) {
        //if(!priceVal.pieceNum[3]){
            priceVal.pieceNum[3] = true;
            priceVal.piece += 1;
            carLight('2');
            SPEED = 2;
        //}
        //if(priceArea.outArea){showPop('p4');}
        showPop('p3');
//      alert('找到了p4提示窗！');
        $('.l4_h').hide();
        showHint(3);
        $('#point2').hide();
        //priceArea.outArea = false;
    }else {
        //priceArea.outArea = true;
        SPEED = 5;
    }
    
    if(priceVal.piece==4){
    	$('#hit_more').attr('src','img/jqml.png');
    	$('#hit_more').bind('touchstart',function(){
    		$('#yxjs').show();
    		$('#Allstuff').hide();
    	});
    }
    
    
    $('.mapx').text(map.x);
    $('.mapy').text(map.y);
    
    
    
});





$('.areas').on('touchstart',function(){
    var target = $(this).attr('data-rol');
    switch(target){
        case 'p1' : if(priceVal.pieceNum[0]){$('#hint').hide();showPop('p1');};break;
        case 'p2' : if(priceVal.pieceNum[1]){$('#hint').hide();showPop('p2');};break;
        case 'p3' : if(priceVal.pieceNum[2]){$('#hint').hide();showPop('p3');};break;
        case 'p4' : if(priceVal.pieceNum[3]){$('#hint').hide();showPop('p4');};break;
        case 'p5' : if(priceVal.pieceNum[4]){$('#hint').hide();showPop('p5');};break;
        default: break;
    }
})

function hideAllpop(){
    $('.ps').css('display','none');
}

function mapMove(x,y,t){
    $('#map').css('-webkit-transform','translate3d('+x+'px,'+y+'px,0)');
    $('#mapc').css('-webkit-transform','rotate('+t+'deg)');
    $('.mapPoint').css('-webkit-transform','rotate('+(-t)+'deg)')
}

function carMov(deg){
    $('#car').css('-webkit-transform','rotate('+deg+'deg)');
}

function showPop(id){
    continueGame.hidden();
    hideAllpop();
    priceVal.stopCar = true;
    $('#pop').css('display','block');
    $('#'+id).fadeIn('fast');
}

function closeBtn(_this){
    $('#'+_this).fadeOut('fast');
    
    setTimeout(function(){
        $('#pop').css('display','none');
        hideAllpop();
    },400)
    
    if ( priceVal.piece == 5 ) { showHint(); }
    else { setTimeout(function(){priceVal.stopCar = false; },800) }
}

$('.close').on('touchstart',function(){
    var id = $(this).attr('data-rol');
    closeBtn(id);
    $('#hint').fadeIn('fast');
    showHint();
})

function carLight(id){
    $('#point'+id).removeClass('flash');
    $('#point'+id).attr('src','img/'+id+'.png');
}

function showHint(i){
  
   
   
     $('#pri_pic'+(i)).css('display','block');
  
   

}

$('#hit_more').on('touchstart',function(){
    $('#hint').fadeOut('fast');
    setTimeout(function(){priceVal.stopCar = false;},800);
 
    
    
    	$('.pri').hide();
    
    	  
    

    closeBtn(priceVal.date);
    if( priceVal.piece >= 4){ continueGame.showbtn(); }
    
})

$('.price').on('touchstart',function(){
    priceVal.date = $(this).attr('data-rol');
    jumpTo(priceVal.piece);
    $('#hint').fadeIn('fast');
    $('#pop').fadeOut('fast');
    showHint()
})

//$('#hit').on('touchstart',function(){
//  window.location.href = "result.html";
//});

$('.yysj').bind('touchstart',function(){
	$('#yysj').show();
});

$('.fxqp').bind('touchstart',function(){
	$('.fx').show();
});

$('.fx').bind('touchstart',function(){
	$('.fx').hide();
});

function jumpTo(get){
    if(get<3){
        $('#hit').css('display','none');
    } else if( get >= 3 && get < 5) {
        $('#hit').css('display','block');
    } else if (get==4) {
        $('#hit_more').css('display','none');
    }
    
    switch(get){
        case 1: ga('send', 'event', 'C17_Explore game', '第一关', 'C17A01L00Explore game页面第一关'); break;
        case 2: ga('send', 'event', 'C17_Explore game', '第二关', 'C17A01L00Explore game页面第二关'); break;
        case 3: ga('send', 'event', 'C17_Explore game', '第三关', 'C17A01L00Explore game页面第三关'); break;
        case 4: ga('send', 'event', 'C17_Explore game', '第四关', 'C17A01L00Explore game页面第四关'); break;
        case 5: ga('send', 'event', 'C17_Explore game', '第五关', 'C17A01L00Explore game页面第五关'); break;
        default: break;
    }
}

var continueGame = {
    showbtn : function(){
        $('#continueGame').css('display','block');
        $('#continueGame').css('opacity','1');
    },
    hidden : function(){
        $('#continueGame').css('display','none');
        $('#continueGame').css('opacity','0');
    }
}

var load_img = new Array;
    load_img = [
       'img/loading/loadbg.jpg',
       'img/loading/loadingb.png',
       'img/loading/loading.png',
       'img/price/p1.png',
       'img/price/p2.png',
       'img/price/p3.png',
       'img/price/p4.png',
       'img/price/price.png',
       'img/price/p1g.png',
       'img/price/p2g.png',
       'img/price/p3g.png',
       'img/price/p4g.png',
       'img/car.png',
       'img/map.jpg',
       'img/1s.png',
       'img/2s.png',
       'img/3s.png',
       'img/4s.png',
       'img/5s.png',
       'img/carbg.png',
       'img/carbgs.png',
       'img/top_lan.png',
       'img/jqml.png',
       'img/qjcl.png',
       'img/iconup.png',
       'img/text1.png',
       'img/text2.png',
       'img/text3.png',
       'img/text4.png',
       'img/text5.png',
       'img/bg1.jpg',
       'img/bg2.jpg',
       'img/bg3.jpg',
       'img/bg4.jpg',
       'img/bg5.jpg',
       'img/rou1.png',
       'img/rou2.png',
       'img/rou3.png',
       'img/hair1.png',
       'img/hair2.png',
       'img/hair3.png',
       'img/xz1.png',
       'img/xz2.png',
       'img/xz3.png',
       'img/hz1.png',
       'img/hz2.png',
       'img/hz3.png',
       'img/load.gif',
       'img/yysj.png',
       'img/fxqp.png',
       'img/zsh1.png',
       'img/zsh2.png',
       'img/zsh3.png',
       'img/jsbg.jpg',
       'img/pao1.png',
       'img/pao2.png',
       'img/yybg.jpg',
       'img/yyl.png',
       'img/Prompt1.png',
       'img/l1_h.png',
       'img/l1_l.png',
       'img/l2_h.png',
       'img/l2_l.png',
       'img/l3_h.png',
       'img/l3_l.png',
       'img/l4_h.png',
       'img/l4_l.png',
       'img/fx.png'
    ]
    
var img = new Image();      // 声明对象，使用 image 对象中的 onload 方法

//加载完成
var loading = {
    end : function(){
        $('#loading').hide();
        $('#wrap').show();
    }
}



resourceDir="";
function loadResources(urls, progress) {
    var loadedCount = 0;
    var loaded = function () {
        ++loadedCount;
        if (progress) progress(urls.length, loadedCount, this);
    };
    for (var i = 0; i < urls.length; ++i) {
        if (!urls[i]) {
            loaded();
            return;
        }
        var img = new Image();
        //resourceMap[urls[i]] = img;
        img.onload = loaded;
        img.onabort = loaded;
        img.onerror = loaded;
        img.src = resourceDir + urls[i];//+ "?ver=" + j_version;
        $('#load_bar').css('width',(i/urls.length*100)+'%');
    }
}

loadResources(load_img,function (n, i, img) {
    $('#load_bar').css('opacity',1);
    $('#load_bar').css('width',Math.round(i * 100 / n) + "%");
    if (i > load_img.length-1){
    setTimeout("loading.end()",500)
    }
})


//开始游戏
$('.ksyx').bind('touchstart',function(){
	$('#wrap').hide();
	$('#Allstuff').show();
    START.loadin = true;
    setTimeout(function(){$('#Prompt').fadeOut('fast');START = false;setTimeout(function(){priceVal.stopCar = false},1200);},5500);
    snowStart();
//  $('#hm').attr('src','img/yx.mp3');
    $('.music_k').show();
    $('.music_g').hide();
});





    
//雪花
function snowStart() {


	function randomRange(t, i) {
		return Math.random() * (i - t) + t
	}
	Particle3D = function(t) {
		THREE.Particle.call(this, t), this.velocity = new THREE.Vector3(0, -2, 0), this.velocity.rotateX(randomRange(-45, 45)), this.velocity.rotateY(randomRange(0, 360)), this.gravity = new THREE.Vector3(0, 0, 0), this.drag = 1
	}, Particle3D.prototype = new THREE.Particle, Particle3D.prototype.constructor = Particle3D, Particle3D.prototype.updatePhysics = function() {
		this.velocity.multiplyScalar(this.drag), this.velocity.addSelf(this.gravity), this.position.addSelf(this.velocity)
	};
	var TO_RADIANS = Math.PI / 180;
	THREE.Vector3.prototype.rotateY = function(t) {
		cosRY = Math.cos(t * TO_RADIANS), sinRY = Math.sin(t * TO_RADIANS);
		var i = this.z,
			o = this.x;
		this.x = o * cosRY + i * sinRY, this.z = o * -sinRY + i * cosRY
	}, THREE.Vector3.prototype.rotateX = function(t) {
		cosRY = Math.cos(t * TO_RADIANS), sinRY = Math.sin(t * TO_RADIANS);
		var i = this.z,
			o = this.y;
		this.y = o * cosRY + i * sinRY, this.z = o * -sinRY + i * cosRY
	}, THREE.Vector3.prototype.rotateZ = function(t) {
		cosRY = Math.cos(t * TO_RADIANS), sinRY = Math.sin(t * TO_RADIANS);
		var i = this.x,
			o = this.y;
		this.y = o * cosRY + i * sinRY, this.x = o * -sinRY + i * cosRY
	};


	$(function() {
		var container = document.querySelector(".snow-container");
		if (/MSIE 6|MSIE 7|MSIE 8/.test(navigator.userAgent)) {
			return
		} else {
			if (/MSIE 9|MSIE 10/.test(navigator.userAgent)) {
				$(container).css("height", $(window).height()).bind("click", function() {
					$(this).remove()
				})
			}
		}
		var containerWidth = $(container).width();
		var containerHeight = $(container).height();
		var particle;
		var camera;
		var scene;
		var renderer;
		var mouseX = 0;
		var mouseY = 0;
		var windowHalfX = window.innerWidth / 2;
		var windowHalfY = window.innerHeight / 2;
		var particles = [];
		var particleImage = new Image();
		particleImage.src = "http://img14.360buyimg.com/cms/jfs/t595/323/625407732/3275/e86993e8/5476ba25Ne75aa640.png";
		var snowNum = 350;

		function init() {
			camera = new THREE.PerspectiveCamera(75, containerWidth / containerHeight, 1, 10000);
			camera.position.z = 1000;
			scene = new THREE.Scene();
			scene.add(camera);
			renderer = new THREE.CanvasRenderer();
			renderer.setSize(containerWidth, containerHeight);
			var material = new THREE.ParticleBasicMaterial({
				map: new THREE.Texture(particleImage)
			});
			for (var i = 0; i < snowNum; i++) {
				particle = new Particle3D(material);
				particle.position.x = Math.random() * 2000 - 1000;
				particle.position.y = Math.random() * 2000 - 1000;
				particle.position.z = Math.random() * 2000 - 1000;
				particle.scale.x = particle.scale.y = 1;
				scene.add(particle);
				particles.push(particle)
			}
			container.appendChild(renderer.domElement);
			document.addEventListener("mousemove", onDocumentMouseMove, false);
			document.addEventListener("touchstart", onDocumentTouchStart, false);
			document.addEventListener("touchmove", onDocumentTouchMove, false);
			setInterval(loop,1000/40);
		}

		function onDocumentMouseMove(event) {
			mouseX = event.clientX - windowHalfX;
			mouseY = event.clientY - windowHalfY
		}

		function onDocumentTouchStart(event) {
			if (event.touches.length == 1) {
				event.preventDefault();
				mouseX = event.touches[0].pageX - windowHalfX;
				mouseY = event.touches[0].pageY - windowHalfY
			}
		}

		function onDocumentTouchMove(event) {
			if (event.touches.length == 1) {
				event.preventDefault();
				mouseX = event.touches[0].pageX - windowHalfX;
				mouseY = event.touches[0].pageY - windowHalfY
			}
		}

		function loop() {
			
			for (var i = 0; i < particles.length; i++) {
				var particle = particles[i];
				particle.updatePhysics();
				with(particle.position) {
					if (y < -1000) {
						y += 2000
					}
					if (x > 1000) {
						x -= 2000
					} else {
						if (x < -1000) {
							x += 2000
						}
					}
					if (z > 1000) {
						z -= 2000
					} else {
						if (z < -1000) {
							z += 2000
						}
					}
				}
			}
			camera.position.x += (mouseX - camera.position.x) * 0.5;
			camera.position.y += (-mouseY - camera.position.y) * 0.5;
			camera.lookAt(scene.position);
			renderer.render(scene, camera);
		}
		init()
	});


}</script>

<script>
	if(window.location.href.indexOf('#')>0){
	window.location.href = "index.html";
	}
	window.addEventListener("orientationchange", function() { 
	if(window.orientation == 90 || window.orientation == -90){
	    document.getElementsByClassName('horizontal').item(0).style.display = 'block';
	    } else {
	        window.location.reload();
	    }
	}, false);
</script>





<script type="text/javascript" src="js/pageSwitch.js"></script>
<script>
	var reg=location.search.match(),
	ts=reg&&reg[1]||'scrollY',
	a=new pageSwitch('pages',{
    duration:450,
    start:0,
    direction:1,
    loop:false,
    ease:'ease',
    transition:ts,
	freeze:false,
	mouse:false,
    mousewheel:false,
    arrowkey:true
    });
 

    
</script>






</body>
</html>